---
import Base from '../layouts/Base.astro';
import { fetchMatches } from '../lib/fetchMatches';

export async function getStaticPaths() {
  const matches = await fetchMatches();
  return matches.map(match => ({
    params: { match: match.id },
    props: { match, allMatches: matches }
  }));
}

const { match } = Astro.props;

const pageTitle = `${match.team_a} vs ${match.team_b} en vivo${match.league ? ' - ' + match.league : ''} | Pirlo TV`;
const pageDescription = `Ver ${match.team_a} vs ${match.team_b} en vivo. Roja Directa - Pirlo TV. Sin registrarse`;
---

<Base title={pageTitle} description={pageDescription}>
  <nav class="breadcrumb">
    <a href="/">Inicio</a> / <span>{match.team_a} vs {match.team_b}</span>
  </nav>

  <main class="match-container">
    <section class="match-header">
      <h1>{match.team_a} <span class="vs">vs</span> {match.team_b}</h1>
      <div class="match-meta">
        {match.league && <span class="league">{match.league}</span>}
        <span class="date">{new Date(match.date).toLocaleDateString('es-ES')}</span>
        <span class="time">{match.time}</span>
      </div>
    </section>

    <section class="stream-section">
      <div class="stream-container">
        <iframe
          src={match.decoded_iframe_url}
          title={`${match.team_a} vs ${match.team_b}`}
          allow="autoplay; fullscreen"
          allowFullScreen
          style={{ width: '100%', height: '500px', borderRadius: '0.5rem', border: '0' }}
        ></iframe>
      </div>

      <aside class="match-details">
        <div class="detail-card">
          <h2>Información</h2>
          <dl>
            <dt>Local</dt><dd>{match.team_a}</dd>
            <dt>Visitante</dt><dd>{match.team_b}</dd>
            {match.league && (<><dt>Liga</dt><dd>{match.league}</dd></>)}
            <dt>Hora</dt><dd>{match.time}</dd>
          </dl>
        </div>
        <div class="detail-card">
          <h2>Opciones</h2>
          <ul>
            <li>Roja Directa</li>
            <li>Pirlo TV</li>
            <li>Sin registrarse</li>
            <li>En HD</li>
          </ul>
        </div>
      </aside>
    </section>

    <section class="faq-match">
      <h2>Preguntas frecuentes</h2>
      <div class="faq-item">
        <h3>¿A qué hora comienza el partido?</h3>
        <p>El partido comenzará a las {match.time} hora local.</p>
      </div>
      <div class="faq-item">
        <h3>¿Puedo ver sin registrarme?</h3>
        <p>Sí, en Pirlo TV puedes ver sin crear cuenta.</p>
      </div>
    </section>

    <script type="application/ld+json" set:html={`{
      "@context": "https://schema.org",
      "@type": "SportsEvent",
      "name": "${match.team_a} vs ${match.team_b}",
      "startDate": "${match.date}T${match.time}",
      "performer": [
        {"@type": "SportsTeam", "name": "${match.team_a}"},
        {"@type": "SportsTeam", "name": "${match.team_b}"}
      ]
    }`}></script>
  </main>
</Base>

<style>
  .breadcrumb {
    max-width: 1200px;
    margin: 1.5rem auto 0;
    padding: 0 2rem;
    font-size: 0.9rem;
    color: #aaa;
  }

  .match-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem;
  }

  .match-header h1 {
    font-size: 2.2rem;
    margin-bottom: 0.5rem;
  }

  .vs {
    color: #999;
    font-size: 1.1rem;
  }

  .match-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
    font-size: 0.9rem;
    color: #ccc;
  }

  .league {
    color: #ffd54f;
  }

  .stream-section {
    display: grid;
    grid-template-columns: minmax(0, 1.5fr) minmax(0, 0.7fr);
    gap: 2rem;
    margin: 3rem 0;
  }

  .match-details {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .detail-card {
    padding: 1.5rem;
    background: #181818;
    border-radius: 0.5rem;
  }

  .detail-card dl {
    display: grid;
    grid-template-columns: auto 1fr;
    gap: 0.5rem 1rem;
    margin: 0;
  }

  .detail-card dt {
    font-weight: 600;
  }

  .detail-card dd {
    margin: 0;
  }

  .faq-match {
    margin-top: 2rem;
  }

  .faq-item + .faq-item {
    margin-top: 1rem;
  }

  @media (max-width: 768px) {
    .stream-section {
      grid-template-columns: 1fr;
    }
  }
</style>

